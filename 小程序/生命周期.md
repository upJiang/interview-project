# 微信小程序生命周期

## 应用生命周期

App函数用于注册一个小程序，通过App构造器提供的生命周期回调，可以监听小程序的运行状态：

### onLaunch(options)

小程序初始化完成时触发，全局只触发一次。

- **参数说明**:
  - `path`: 启动页面路径
  - `query`: 启动参数
  - `scene`: 场景值
  - `shareTicket`: 分享信息
  - `referrerInfo`: 来源信息

- **使用场景**:
  - 获取小程序启动参数
  - 进行全局初始化操作
  - 检查小程序更新版本

### onShow(options)

小程序启动，或从后台进入前台显示时触发。

- **使用场景**:
  - 从后台恢复状态
  - 刷新数据
  - 记录用户活跃状态
  - 重新连接网络或WebSocket

### onHide()

小程序从前台进入后台时触发。

- **使用场景**:
  - 暂停音乐播放
  - 保存用户操作状态
  - 暂停定时器或动画
  - 关闭非必要的网络连接

### onError(error)

小程序发生脚本错误或API调用错误时触发。

- **使用场景**:
  - 记录错误日志
  - 上报错误信息
  - 展示友好的错误提示

### onPageNotFound(res)

小程序要打开的页面不存在时触发。

- **使用场景**:
  - 跳转到404页面
  - 重定向到首页或其他有效页面

```javascript
// 示例：重定向到404页面
wx.redirectTo({
  url: 'pages/404/404'
})
```

### globalData

全局数据对象，可用于在不同页面间共享数据。

```javascript
// 示例：定义全局数据
globalData: {
  userInfo: null,
  token: ''
}
```

## 页面生命周期

Page函数用于注册一个页面，通过Page构造器提供的生命周期回调，可以监听页面的加载和渲染过程：

### onLoad(options)

页面加载时触发，一个页面只会调用一次。

- **使用场景**:
  - 解析路由参数
  - 初始化页面数据
  - 发起网络请求
  - 注册事件监听

### onShow()

页面显示/切入前台时触发。

- **使用场景**:
  - 刷新页面数据
  - 开始播放音频或视频
  - 恢复页面状态

### onReady()

页面初次渲染完成时触发，一个页面只会调用一次。

- **使用场景**:
  - 获取页面元素
  - 执行需要等待页面渲染完成的操作
  - 开始动画

### onHide()

页面隐藏/切入后台时触发。

- **使用场景**:
  - 暂停播放音频或视频
  - 暂停定时器
  - 保存临时状态

### onUnload()

页面卸载时触发。

- **使用场景**:
  - 清理定时器
  - 保存未提交的表单数据
  - 取消事件监听

### onPullDownRefresh()

下拉刷新时触发。

- **使用场景**:
  - 重新获取数据
  - 刷新页面内容

```javascript
// 示例：刷新完成后停止下拉刷新动画
setTimeout(function() {
  wx.stopPullDownRefresh()
}, 1000)
```

### onReachBottom()

上拉触底时触发。

- **使用场景**:
  - 加载更多数据
  - 实现分页加载

### onShareAppMessage()

用户点击右上角分享时触发。

- **返回值**:
  - `title`: 分享标题
  - `path`: 分享路径
  - `imageUrl`: 分享图片

```javascript
// 示例：自定义分享内容
return {
  title: '分享标题',
  path: '/pages/index/index',
  imageUrl: '分享图片'
}
```

### onResize(size)

页面尺寸改变时触发。

- **使用场景**:
  - 响应屏幕旋转
  - 调整页面布局

### onTabItemTap(item)

点击 tab 时触发（仅在 tab 页面中触发）。

- **使用场景**:
  - 记录tab点击行为
  - 重置tab页面状态

## 组件生命周期

Component函数用于注册一个自定义组件，组件的生命周期方法定义在`lifetimes`对象中：

### created()

组件实例刚创建时触发。

- **说明**:
  - 此时不能调用 setData
  - 可以进行一些不依赖节点的初始化工作

### attached()

组件实例进入页面节点树时触发。

- **使用场景**:
  - 初始化组件内部状态
  - 获取组件属性值
  - 进行数据请求或计算

### ready()

组件在视图层布局完成后执行。

- **使用场景**:
  - 获取页面元素
  - 执行需要等待页面渲染完成的操作

### moved()

组件实例被移动到节点树另一个位置时触发。

- **使用场景**:
  - 响应页面布局变化

### detached()

组件实例被从页面节点树移除时触发。

- **使用场景**:
  - 清理工作

### error(error)

每当组件方法抛出错误时执行。

- **使用场景**:
  - 记录错误日志
  - 展示友好的错误提示

## 常见面试题

1. 微信小程序的应用生命周期和页面生命周期有哪些?
2. onLoad和onShow的区别是什么?
3. 如何在多个页面间共享数据?
4. 页面返回时，上一个页面的生命周期是怎样的?
5. 组件的生命周期与页面的生命周期有什么不同? 