# ç°ä»£æ„å»ºå·¥å…·æ·±åº¦å¯¹æ¯”ç›¸å…³é—®é¢˜ - å‰ç«¯é¢è¯•æŒ‡å—

## ğŸ“‹ å¸¸è§é¢è¯•é¢˜ä¸ç­”æ¡ˆ

### Q1: Webpackã€Viteã€Rollupçš„æ ¸å¿ƒå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆï¼š**
ä¸‰è€…éƒ½æ˜¯ç°ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œä½†åœ¨æ„å»ºç­–ç•¥ã€å¼€å‘ä½“éªŒã€æ‰“åŒ…ä¼˜åŒ–ç­‰æ–¹é¢æœ‰æ˜¾è‘—å·®å¼‚ã€‚

**é¢è¯•å›ç­”æŠ€å·§ï¼š**
```javascript
// æ„å»ºå·¥å…·æ ¸å¿ƒå·®å¼‚å¯¹æ¯”
const BuildToolsComparison = {
  webpack: {
    æ ¸å¿ƒç†å¿µ: "ä¸€åˆ‡çš†æ¨¡å—ï¼Œé€šè¿‡loaderå’Œpluginå¤„ç†å„ç§èµ„æº",
    æ„å»ºæ–¹å¼: "Bundle-basedï¼Œå°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆå°‘æ•°å‡ ä¸ªæ–‡ä»¶",
    å¼€å‘æœåŠ¡å™¨: "webpack-dev-serverï¼Œçƒ­æ›´æ–°åŸºäºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ",
    é…ç½®å¤æ‚åº¦: "é«˜ï¼Œéœ€è¦è¯¦ç»†é…ç½®loaderã€pluginã€optimizationç­‰",
    
    ä¼˜åŠ¿: [
      "ç”Ÿæ€æœ€æˆç†Ÿï¼Œæ’ä»¶å’Œloaderä¸°å¯Œ",
      "æ”¯æŒå„ç§å¤æ‚åœºæ™¯å’Œä¼˜åŒ–ç­–ç•¥",
      "ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½æ”¯æŒå®Œå–„",
      "HMRï¼ˆçƒ­æ¨¡å—æ›¿æ¢ï¼‰åŠŸèƒ½å¼ºå¤§"
    ],
    
    åŠ£åŠ¿: [
      "é…ç½®å¤æ‚ï¼Œå­¦ä¹ æˆæœ¬é«˜",
      "å†·å¯åŠ¨é€Ÿåº¦æ…¢ï¼Œç‰¹åˆ«æ˜¯å¤§å‹é¡¹ç›®",
      "æ„å»ºé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢"
    ],
    
    é€‚ç”¨åœºæ™¯: [
      "å¤§å‹å¤æ‚é¡¹ç›®",
      "éœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„æ„å»ºæµç¨‹",
      "å¯¹å…¼å®¹æ€§è¦æ±‚é«˜çš„é¡¹ç›®",
      "å·²æœ‰webpackç”Ÿæ€çš„é¡¹ç›®"
    ]
  },

  vite: {
    æ ¸å¿ƒç†å¿µ: "åŸºäºESMçš„å¿«é€Ÿå¼€å‘æ„å»ºå·¥å…·",
    æ„å»ºæ–¹å¼: "å¼€å‘æ—¶åŸºäºESMï¼Œç”Ÿäº§æ—¶ä½¿ç”¨Rollupæ‰“åŒ…",
    å¼€å‘æœåŠ¡å™¨: "åŸºäºESMçš„dev serverï¼ŒæŒ‰éœ€ç¼–è¯‘",
    é…ç½®å¤æ‚åº¦: "ä½ï¼Œçº¦å®šå¤§äºé…ç½®ï¼Œå¼€ç®±å³ç”¨",
    
    ä¼˜åŠ¿: [
      "å¼€å‘å¯åŠ¨é€Ÿåº¦æå¿«",
      "çƒ­æ›´æ–°é€Ÿåº¦å¿«ï¼Œåªæ›´æ–°å˜åŒ–çš„æ¨¡å—",
      "é…ç½®ç®€å•ï¼Œå¼€ç®±å³ç”¨",
      "åŸç”Ÿæ”¯æŒTypeScriptã€JSXç­‰"
    ],
    
    åŠ£åŠ¿: [
      "ç”Ÿæ€ç›¸å¯¹è¾ƒæ–°ï¼Œæ’ä»¶ä¸å¦‚webpackä¸°å¯Œ",
      "å¯¹è€æ—§æµè§ˆå™¨æ”¯æŒéœ€è¦é¢å¤–é…ç½®",
      "æŸäº›å¤æ‚åœºæ™¯å¯èƒ½éœ€è¦é¢å¤–å¤„ç†"
    ],
    
    é€‚ç”¨åœºæ™¯: [
      "ç°ä»£å‰ç«¯é¡¹ç›®ï¼ˆVue 3ã€Reactç­‰ï¼‰",
      "è¿½æ±‚å¼€å‘ä½“éªŒçš„é¡¹ç›®",
      "ä¸­å°å‹åˆ°ä¸­å¤§å‹é¡¹ç›®",
      "åŸå‹å¼€å‘å’Œå¿«é€Ÿè¿­ä»£"
    ]
  },

  rollup: {
    æ ¸å¿ƒç†å¿µ: "ä¸“æ³¨äºESæ¨¡å—çš„é«˜æ•ˆæ‰“åŒ…å·¥å…·",
    æ„å»ºæ–¹å¼: "Tree-shakingä¼˜å…ˆï¼Œç”Ÿæˆç²¾ç®€çš„ESæ¨¡å—è¾“å‡º",
    å¼€å‘æœåŠ¡å™¨: "é€šå¸¸é…åˆå…¶ä»–å·¥å…·ä½¿ç”¨",
    é…ç½®å¤æ‚åº¦: "ä¸­ç­‰ï¼Œä¸“æ³¨äºæ‰“åŒ…é…ç½®",
    
    ä¼˜åŠ¿: [
      "Tree-shakingæ•ˆæœæœ€ä½³",
      "è¾“å‡ºä»£ç ç®€æ´ï¼Œé€‚åˆåº“å¼€å‘",
      "æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼ˆUMDã€CJSã€ESMç­‰ï¼‰",
      "æ„å»ºé€Ÿåº¦å¿«"
    ],
    
    åŠ£åŠ¿: [
      "ä¸»è¦é¢å‘åº“å¼€å‘ï¼Œåº”ç”¨å¼€å‘åŠŸèƒ½æœ‰é™",
      "å¼€å‘æœåŠ¡å™¨åŠŸèƒ½è¾ƒå¼±",
      "å¤„ç†å¤æ‚èµ„æºï¼ˆå›¾ç‰‡ã€CSSç­‰ï¼‰éœ€è¦é¢å¤–é…ç½®"
    ],
    
    é€‚ç”¨åœºæ™¯: [
      "JavaScriptåº“å’Œç»„ä»¶åº“å¼€å‘",
      "éœ€è¦å¤šç§è¾“å‡ºæ ¼å¼çš„é¡¹ç›®",
      "å¯¹åŒ…ä½“ç§¯è¦æ±‚æé«˜çš„é¡¹ç›®",
      "ä½œä¸ºå…¶ä»–å·¥å…·çš„åº•å±‚æ‰“åŒ…å™¨"
    ]
  }
};
```

### Q2: å¦‚ä½•ä¼˜åŒ–Webpackæ„å»ºæ€§èƒ½ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆï¼š**
Webpackæ€§èƒ½ä¼˜åŒ–åŒ…æ‹¬æ„å»ºé€Ÿåº¦ä¼˜åŒ–å’Œæ‰“åŒ…ä½“ç§¯ä¼˜åŒ–ä¸¤ä¸ªæ–¹é¢ã€‚

**é¢è¯•å›ç­”æŠ€å·§ï¼š**
```javascript
// Webpackæ€§èƒ½ä¼˜åŒ–é…ç½®
class WebpackOptimization {
  // 1. æ„å»ºé€Ÿåº¦ä¼˜åŒ–
  getBuildSpeedOptimizations() {
    return {
      // ä½¿ç”¨æ›´å¿«çš„source-map
      devtool: 'eval-cheap-module-source-map', // å¼€å‘ç¯å¢ƒ
      // devtool: 'source-map', // ç”Ÿäº§ç¯å¢ƒ
      
      // ç¼“å­˜é…ç½®
      cache: {
        type: 'filesystem',
        cacheDirectory: path.resolve(__dirname, '.webpack_cache'),
        buildDependencies: {
          config: [__filename]
        }
      },
      
      // å¤šè¿›ç¨‹æ„å»º
      module: {
        rules: [
          {
            test: /\.js$/,
            use: [
              {
                loader: 'thread-loader',
                options: {
                  workers: require('os').cpus().length - 1
                }
              },
              'babel-loader'
            ],
            exclude: /node_modules/
          }
        ]
      },
      
      // ä¼˜åŒ–è§£æ
      resolve: {
        // å‡å°‘è§£ææ­¥éª¤
        modules: [path.resolve(__dirname, 'src'), 'node_modules'],
        // æŒ‡å®šæ‰©å±•åé¡ºåº
        extensions: ['.js', '.jsx', '.ts', '.tsx', '.json'],
        // åˆ«åé…ç½®
        alias: {
          '@': path.resolve(__dirname, 'src'),
          'react': path.resolve(__dirname, 'node_modules/react')
        },
        // ä¼˜åŒ–æ¨¡å—è§£æ
        symlinks: false
      },
      
      // å¿½ç•¥ä¸å¿…è¦çš„æ–‡ä»¶
      module: {
        noParse: /jquery|lodash/, // è·³è¿‡æ²¡æœ‰ä¾èµ–çš„åº“
      },
      
      // å¤–éƒ¨ä¾èµ–
      externals: {
        react: 'React',
        'react-dom': 'ReactDOM'
      }
    };
  }

  // 2. æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–
  getBundleSizeOptimizations() {
    return {
      optimization: {
        // ä»£ç åˆ†å‰²
        splitChunks: {
          chunks: 'all',
          cacheGroups: {
            // ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…
            vendor: {
              test: /[\\/]node_modules[\\/]/,
              name: 'vendors',
              chunks: 'all',
              priority: 10
            },
            // å…¬å…±ä»£ç æå–
            common: {
              name: 'common',
              minChunks: 2,
              chunks: 'all',
              priority: 5,
              reuseExistingChunk: true
            }
          }
        },
        
        // å‹ç¼©é…ç½®
        minimize: true,
        minimizer: [
          new TerserPlugin({
            terserOptions: {
              compress: {
                drop_console: true, // ç§»é™¤console
                drop_debugger: true, // ç§»é™¤debugger
                pure_funcs: ['console.log'] // ç§»é™¤ç‰¹å®šå‡½æ•°
              },
              mangle: {
                safari10: true // è§£å†³Safari 10çš„bug
              }
            },
            extractComments: false // ä¸æå–æ³¨é‡Šåˆ°å•ç‹¬æ–‡ä»¶
          }),
          new CssMinimizerPlugin()
        ],
        
        // è¿è¡Œæ—¶ä»£ç ä¼˜åŒ–
        runtimeChunk: {
          name: 'runtime'
        }
      },
      
      // æ’ä»¶ä¼˜åŒ–
      plugins: [
        // åˆ†ææ‰“åŒ…ç»“æœ
        new BundleAnalyzerPlugin({
          analyzerMode: process.env.ANALYZE ? 'server' : 'disabled'
        }),
        
        // å‹ç¼©CSS
        new MiniCssExtractPlugin({
          filename: 'css/[name].[contenthash:8].css',
          chunkFilename: 'css/[name].[contenthash:8].chunk.css'
        }),
        
        // å‹ç¼©å›¾ç‰‡
        new ImageMinimizerPlugin({
          minimizer: {
            implementation: ImageMinimizerPlugin.imageminMinify,
            options: {
              plugins: [
                ['imagemin-mozjpeg', { quality: 80 }],
                ['imagemin-pngquant', { quality: [0.6, 0.8] }]
              ]
            }
          }
        })
      ]
    };
  }

  // 3. å¼€å‘ç¯å¢ƒä¼˜åŒ–
  getDevOptimizations() {
    return {
      devServer: {
        // çƒ­æ›´æ–°
        hot: true,
        // å¯ç”¨gzipå‹ç¼©
        compress: true,
        // å‡å°‘æ—¥å¿—è¾“å‡º
        stats: 'errors-warnings',
        // å®¢æˆ·ç«¯æ—¥å¿—çº§åˆ«
        client: {
          logging: 'warn'
        }
      },
      
      // ä¼˜åŒ–é‡æ–°æ„å»ºé€Ÿåº¦
      watchOptions: {
        ignored: /node_modules/,
        aggregateTimeout: 300,
        poll: false
      }
    };
  }

  // 4. Tree Shakingä¼˜åŒ–
  getTreeShakingConfig() {
    return {
      mode: 'production',
      optimization: {
        usedExports: true,
        sideEffects: false // æ ‡è®°æ— å‰¯ä½œç”¨
      },
      
      // é…ç½®babelä¸è½¬æ¢ESæ¨¡å—
      module: {
        rules: [
          {
            test: /\.js$/,
            use: {
              loader: 'babel-loader',
              options: {
                presets: [
                  ['@babel/preset-env', {
                    modules: false // ä¿æŒESæ¨¡å—æ ¼å¼
                  }]
                ]
              }
            }
          }
        ]
      }
    };
  }

  // 5. å®Œæ•´çš„ä¼˜åŒ–é…ç½®ç¤ºä¾‹
  getOptimizedConfig() {
    return {
      ...this.getBuildSpeedOptimizations(),
      ...this.getBundleSizeOptimizations(),
      ...this.getDevOptimizations(),
      ...this.getTreeShakingConfig(),
      
      // æ€§èƒ½é¢„ç®—
      performance: {
        hints: 'warning',
        maxEntrypointSize: 512000, // 512KB
        maxAssetSize: 512000
      }
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const webpackOptimizer = new WebpackOptimization();
const optimizedConfig = webpackOptimizer.getOptimizedConfig();
```

### Q3: Viteçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é…ç½®å’Œä¼˜åŒ–ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆï¼š**
ViteåŸºäºESMå’Œesbuildï¼Œå¼€å‘æ—¶åˆ©ç”¨æµè§ˆå™¨åŸç”ŸESæ¨¡å—æ”¯æŒï¼Œç”Ÿäº§æ—¶ä½¿ç”¨Rollupæ‰“åŒ…ã€‚

**é¢è¯•å›ç­”æŠ€å·§ï¼š**
```javascript
// Viteé…ç½®å’Œä¼˜åŒ–
import { defineConfig } from 'vite';
import { resolve } from 'path';
import vue from '@vitejs/plugin-vue';
import { createHtmlPlugin } from 'vite-plugin-html';

class ViteOptimization {
  // 1. åŸºç¡€é…ç½®
  getBaseConfig() {
    return defineConfig({
      // æ ¹ç›®å½•
      root: process.cwd(),
      
      // åŸºç¡€è·¯å¾„
      base: process.env.NODE_ENV === 'production' ? '/my-app/' : '/',
      
      // ç¯å¢ƒå˜é‡
      envPrefix: 'VITE_',
      
      // è·¯å¾„åˆ«å
      resolve: {
        alias: {
          '@': resolve(__dirname, 'src'),
          '@components': resolve(__dirname, 'src/components'),
          '@utils': resolve(__dirname, 'src/utils')
        }
      },
      
      // CSSé…ç½®
      css: {
        preprocessorOptions: {
          scss: {
            additionalData: `@import "@/styles/variables.scss";`
          }
        },
        modules: {
          localsConvention: 'camelCase'
        }
      }
    });
  }

  // 2. å¼€å‘ç¯å¢ƒé…ç½®
  getDevConfig() {
    return {
      server: {
        // ç«¯å£
        port: 3000,
        // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
        open: true,
        // çƒ­æ›´æ–°
        hmr: {
          overlay: true
        },
        // ä»£ç†é…ç½®
        proxy: {
          '/api': {
            target: 'http://localhost:8080',
            changeOrigin: true,
            rewrite: (path) => path.replace(/^\/api/, '')
          }
        },
        // CORS
        cors: true
      },
      
      // ä¾èµ–é¢„æ„å»º
      optimizeDeps: {
        // å¼ºåˆ¶é¢„æ„å»ºçš„ä¾èµ–
        include: ['lodash-es', 'axios'],
        // æ’é™¤é¢„æ„å»ºçš„ä¾èµ–
        exclude: ['@vueuse/core']
      }
    };
  }

  // 3. ç”Ÿäº§ç¯å¢ƒé…ç½®
  getProdConfig() {
    return {
      build: {
        // è¾“å‡ºç›®å½•
        outDir: 'dist',
        // é™æ€èµ„æºç›®å½•
        assetsDir: 'assets',
        // æ¸…ç©ºè¾“å‡ºç›®å½•
        emptyOutDir: true,
        
        // ä»£ç åˆ†å‰²
        rollupOptions: {
          output: {
            // æ‰‹åŠ¨åˆ†åŒ…
            manualChunks: {
              'vue-vendor': ['vue', 'vue-router'],
              'ui-vendor': ['element-plus'],
              'utils-vendor': ['lodash-es', 'dayjs']
            },
            // æ–‡ä»¶å‘½å
            chunkFileNames: 'js/[name]-[hash].js',
            entryFileNames: 'js/[name]-[hash].js',
            assetFileNames: (assetInfo) => {
              const info = assetInfo.name.split('.');
              const ext = info[info.length - 1];
              if (/\.(mp4|webm|ogg|mp3|wav|flac|aac)$/.test(assetInfo.name)) {
                return `media/[name]-[hash].${ext}`;
              }
              if (/\.(png|jpe?g|gif|svg)$/.test(assetInfo.name)) {
                return `images/[name]-[hash].${ext}`;
              }
              if (ext === 'css') {
                return `css/[name]-[hash].${ext}`;
              }
              return `assets/[name]-[hash].${ext}`;
            }
          }
        },
        
        // å‹ç¼©é…ç½®
        minify: 'esbuild',
        
        // ç”Ÿæˆsource map
        sourcemap: process.env.NODE_ENV === 'development',
        
        // èµ„æºå†…è”é˜ˆå€¼
        assetsInlineLimit: 4096,
        
        // CSSä»£ç åˆ†å‰²
        cssCodeSplit: true,
        
        // æ„å»ºæŠ¥å‘Š
        reportCompressedSize: false
      }
    };
  }

  // 4. æ’ä»¶é…ç½®
  getPluginsConfig() {
    return [
      // Vueæ”¯æŒ
      vue(),
      
      // HTMLæ¨¡æ¿
      createHtmlPlugin({
        minify: true,
        inject: {
          data: {
            title: 'My Vite App'
          }
        }
      }),
      
      // è‡ªåŠ¨å¯¼å…¥
      AutoImport({
        imports: ['vue', 'vue-router'],
        dts: true
      }),
      
      // ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
      Components({
        dts: true
      }),
      
      // PWA
      VitePWA({
        registerType: 'autoUpdate',
        workbox: {
          globPatterns: ['**/*.{js,css,html,ico,png,svg}']
        }
      }),
      
      // æ‰“åŒ…åˆ†æ
      process.env.ANALYZE && bundleAnalyzer()
    ];
  }

  // 5. æ€§èƒ½ä¼˜åŒ–é…ç½®
  getPerformanceConfig() {
    return {
      // esbuildä¼˜åŒ–
      esbuild: {
        // ç§»é™¤consoleå’Œdebugger
        drop: process.env.NODE_ENV === 'production' ? ['console', 'debugger'] : [],
        // å‹ç¼©æ ‡è¯†ç¬¦
        minifyIdentifiers: true,
        // å‹ç¼©è¯­æ³•
        minifySyntax: true,
        // å‹ç¼©ç©ºç™½
        minifyWhitespace: true
      },
      
      // å®éªŒæ€§åŠŸèƒ½
      experimental: {
        // æ„å»ºä¼˜åŒ–
        buildAdvancedBaseOptions: true
      },
      
      // ä¾èµ–ä¼˜åŒ–
      optimizeDeps: {
        // ä½¿ç”¨esbuildè¿›è¡Œä¾èµ–é¢„æ„å»º
        esbuildOptions: {
          target: 'es2020'
        }
      }
    };
  }

  // 6. å®Œæ•´é…ç½®
  getCompleteConfig() {
    return defineConfig(({ command, mode }) => {
      const isProduction = mode === 'production';
      
      return {
        ...this.getBaseConfig(),
        ...(isProduction ? this.getProdConfig() : this.getDevConfig()),
        ...this.getPerformanceConfig(),
        
        plugins: this.getPluginsConfig(),
        
        // ç¯å¢ƒå˜é‡ç±»å‹å®šä¹‰
        define: {
          __VUE_OPTIONS_API__: true,
          __VUE_PROD_DEVTOOLS__: false
        }
      };
    });
  }
}

// Viteå·¥ä½œåŸç†è¯´æ˜
const ViteWorkingPrinciple = {
  å¼€å‘é˜¶æ®µ: {
    æ¨¡å—è§£æ: "åˆ©ç”¨æµè§ˆå™¨åŸç”ŸESMæ”¯æŒï¼ŒæŒ‰éœ€åŠ è½½æ¨¡å—",
    ç¼–è¯‘ç­–ç•¥: "åªç¼–è¯‘å½“å‰é¡µé¢éœ€è¦çš„æ¨¡å—ï¼Œå®ç°å¿«é€Ÿå†·å¯åŠ¨",
    çƒ­æ›´æ–°: "åŸºäºESMçš„ç²¾ç¡®çƒ­æ›´æ–°ï¼Œåªæ›´æ–°å˜åŒ–çš„æ¨¡å—",
    é¢„æ„å»º: "ä½¿ç”¨esbuildé¢„æ„å»ºnode_modulesä¸­çš„ä¾èµ–"
  },
  
  ç”Ÿäº§é˜¶æ®µ: {
    æ‰“åŒ…å·¥å…·: "ä½¿ç”¨Rollupè¿›è¡Œç”Ÿäº§æ„å»º",
    ä¼˜åŒ–ç­–ç•¥: "Tree-shakingã€ä»£ç åˆ†å‰²ã€èµ„æºä¼˜åŒ–",
    å…¼å®¹æ€§: "é€šè¿‡@vitejs/plugin-legacyæ”¯æŒè€æ—§æµè§ˆå™¨"
  }
};

// ä½¿ç”¨ç¤ºä¾‹
const viteOptimizer = new ViteOptimization();
export default viteOptimizer.getCompleteConfig();
```

### Q4: å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ„å»ºå·¥å…·ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆï¼š**
é€‰æ‹©æ„å»ºå·¥å…·éœ€è¦è€ƒè™‘é¡¹ç›®è§„æ¨¡ã€å›¢é˜ŸæŠ€æœ¯æ ˆã€æ€§èƒ½è¦æ±‚ã€ç»´æŠ¤æˆæœ¬ç­‰å¤šä¸ªå› ç´ ã€‚

**é¢è¯•å›ç­”æŠ€å·§ï¼š**
```javascript
// æ„å»ºå·¥å…·é€‰æ‹©å†³ç­–æ ‘
class BuildToolSelector {
  // 1. é¡¹ç›®è¯„ä¼°ç»´åº¦
  evaluateProject(projectInfo) {
    const {
      size,           // é¡¹ç›®è§„æ¨¡ï¼šsmall, medium, large
      team,           // å›¢é˜Ÿè§„æ¨¡ï¼š1-5, 6-20, 20+
      framework,      // æ¡†æ¶ï¼šreact, vue, angular, vanilla
      legacy,         // æ˜¯å¦éœ€è¦æ”¯æŒè€æ—§æµè§ˆå™¨
      performance,    // æ€§èƒ½è¦æ±‚ï¼šlow, medium, high
      maintenance,    // ç»´æŠ¤æˆæœ¬è€ƒè™‘ï¼šlow, medium, high
      timeline        // å¼€å‘å‘¨æœŸï¼šshort, medium, long
    } = projectInfo;

    return {
      webpack: this.evaluateWebpack(projectInfo),
      vite: this.evaluateVite(projectInfo),
      rollup: this.evaluateRollup(projectInfo),
      parcel: this.evaluateParcel(projectInfo)
    };
  }

  // 2. Webpacké€‚ç”¨æ€§è¯„ä¼°
  evaluateWebpack(project) {
    let score = 0;
    const reasons = [];

    // é¡¹ç›®è§„æ¨¡åŠ åˆ†
    if (project.size === 'large') {
      score += 30;
      reasons.push('å¤§å‹é¡¹ç›®ï¼Œwebpackç”Ÿæ€å®Œå–„');
    }

    // å¤æ‚é…ç½®éœ€æ±‚
    if (project.complexity === 'high') {
      score += 25;
      reasons.push('å¤æ‚æ„å»ºéœ€æ±‚ï¼Œwebpackå¯å®šåˆ¶æ€§å¼º');
    }

    // å›¢é˜Ÿç»éªŒ
    if (project.webpackExperience) {
      score += 20;
      reasons.push('å›¢é˜Ÿæœ‰webpackç»éªŒ');
    }

    // è€æ—§æµè§ˆå™¨æ”¯æŒ
    if (project.legacy) {
      score += 15;
      reasons.push('éœ€è¦æ”¯æŒè€æ—§æµè§ˆå™¨');
    }

    // å¾®å‰ç«¯æ¶æ„
    if (project.microfrontend) {
      score += 20;
      reasons.push('å¾®å‰ç«¯åœºæ™¯ï¼ŒModule Federationæ”¯æŒ');
    }

    return { score, reasons };
  }

  // 3. Viteé€‚ç”¨æ€§è¯„ä¼°
  evaluateVite(project) {
    let score = 0;
    const reasons = [];

    // ç°ä»£æ¡†æ¶
    if (['vue', 'react'].includes(project.framework)) {
      score += 25;
      reasons.push('ç°ä»£æ¡†æ¶ï¼ŒViteæ”¯æŒè‰¯å¥½');
    }

    // å¼€å‘ä½“éªŒè¦æ±‚
    if (project.devExperience === 'high') {
      score += 30;
      reasons.push('è¿½æ±‚æè‡´å¼€å‘ä½“éªŒ');
    }

    // é¡¹ç›®è§„æ¨¡
    if (['small', 'medium'].includes(project.size)) {
      score += 20;
      reasons.push('ä¸­å°å‹é¡¹ç›®ï¼Œé…ç½®ç®€å•');
    }

    // ç°ä»£æµè§ˆå™¨
    if (!project.legacy) {
      score += 15;
      reasons.push('ä¸»è¦é¢å‘ç°ä»£æµè§ˆå™¨');
    }

    // å¿«é€ŸåŸå‹
    if (project.timeline === 'short') {
      score += 20;
      reasons.push('å¿«é€Ÿå¼€å‘å’ŒåŸå‹éªŒè¯');
    }

    return { score, reasons };
  }

  // 4. Rollupé€‚ç”¨æ€§è¯„ä¼°
  evaluateRollup(project) {
    let score = 0;
    const reasons = [];

    // åº“å¼€å‘
    if (project.type === 'library') {
      score += 40;
      reasons.push('ä¸“ä¸ºåº“å¼€å‘è®¾è®¡');
    }

    // åŒ…ä½“ç§¯è¦æ±‚
    if (project.bundleSize === 'critical') {
      score += 25;
      reasons.push('æè‡´çš„Tree-shakingå’ŒåŒ…ä½“ç§¯ä¼˜åŒ–');
    }

    // å¤šæ ¼å¼è¾“å‡º
    if (project.multipleFormats) {
      score += 20;
      reasons.push('éœ€è¦å¤šç§è¾“å‡ºæ ¼å¼ï¼ˆUMDã€CJSã€ESMï¼‰');
    }

    return { score, reasons };
  }

  // 5. é€‰æ‹©å»ºè®®
  getRecommendation(projectInfo) {
    const evaluations = this.evaluateProject(projectInfo);
    
    // æ‰¾åˆ°æœ€é«˜åˆ†çš„å·¥å…·
    const bestTool = Object.entries(evaluations)
      .sort(([,a], [,b]) => b.score - a.score)[0];

    const [toolName, evaluation] = bestTool;

    return {
      recommended: toolName,
      score: evaluation.score,
      reasons: evaluation.reasons,
      alternatives: this.getAlternatives(evaluations, toolName)
    };
  }

  // 6. å¤‡é€‰æ–¹æ¡ˆ
  getAlternatives(evaluations, recommended) {
    return Object.entries(evaluations)
      .filter(([name]) => name !== recommended)
      .sort(([,a], [,b]) => b.score - a.score)
      .slice(0, 2)
      .map(([name, eval]) => ({
        name,
        score: eval.score,
        reasons: eval.reasons.slice(0, 2)
      }));
  }

  // 7. è¿ç§»å»ºè®®
  getMigrationAdvice(from, to) {
    const migrations = {
      'webpack-to-vite': {
        difficulty: 'medium',
        steps: [
          'åˆ†æwebpacké…ç½®ï¼Œè¯†åˆ«å…³é”®æ’ä»¶',
          'å®‰è£…Viteå’Œç›¸åº”æ’ä»¶',
          'åˆ›å»ºvite.config.jsé…ç½®æ–‡ä»¶',
          'è°ƒæ•´å…¥å£æ–‡ä»¶å’ŒHTMLæ¨¡æ¿',
          'å¤„ç†ç¯å¢ƒå˜é‡å’Œåˆ«å',
          'æµ‹è¯•å’Œè°ƒè¯•æ„å»ºç»“æœ'
        ],
        risks: [
          'æŸäº›webpackæ’ä»¶å¯èƒ½æ²¡æœ‰Viteç­‰ä»·ç‰©',
          'æ„å»ºè¾“å‡ºå¯èƒ½æœ‰å·®å¼‚',
          'éœ€è¦æ›´æ–°CI/CDé…ç½®'
        ]
      },
      
      'webpack-to-rollup': {
        difficulty: 'high',
        steps: [
          'ç¡®è®¤é¡¹ç›®é€‚åˆRollupï¼ˆä¸»è¦æ˜¯åº“é¡¹ç›®ï¼‰',
          'é‡æ–°è®¾è®¡æ„å»ºé…ç½®',
          'å¤„ç†CSSå’Œé™æ€èµ„æº',
          'é…ç½®å¤šæ ¼å¼è¾“å‡º',
          'è®¾ç½®å¼€å‘ç¯å¢ƒ'
        ],
        risks: [
          'Rollupä¸»è¦é¢å‘åº“å¼€å‘',
          'åº”ç”¨å¼€å‘åŠŸèƒ½æœ‰é™',
          'éœ€è¦é¢å¤–å·¥å…·æ”¯æŒ'
        ]
      }
    };

    return migrations[`${from}-to-${to}`] || {
      difficulty: 'unknown',
      message: 'éœ€è¦å…·ä½“åˆ†æè¿ç§»è·¯å¾„'
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const selector = new BuildToolSelector();

// é¡¹ç›®ä¿¡æ¯
const projectInfo = {
  size: 'medium',
  team: 10,
  framework: 'react',
  legacy: false,
  performance: 'high',
  devExperience: 'high',
  timeline: 'medium',
  type: 'application'
};

// è·å–æ¨è
const recommendation = selector.getRecommendation(projectInfo);
console.log('æ¨èæ„å»ºå·¥å…·:', recommendation);

// è¿ç§»å»ºè®®
const migrationAdvice = selector.getMigrationAdvice('webpack', 'vite');
console.log('è¿ç§»å»ºè®®:', migrationAdvice);
```

### Q5: å¦‚ä½•å®ç°æ„å»ºå·¥å…·çš„è‡ªå®šä¹‰æ’ä»¶ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆï¼š**
ä¸åŒæ„å»ºå·¥å…·çš„æ’ä»¶æœºåˆ¶å„æœ‰ç‰¹ç‚¹ï¼Œéœ€è¦ç†è§£å…¶é’©å­ç³»ç»Ÿå’ŒAPIè®¾è®¡ã€‚

**é¢è¯•å›ç­”æŠ€å·§ï¼š**
```javascript
// 1. Webpackæ’ä»¶å¼€å‘
class WebpackCustomPlugin {
  constructor(options = {}) {
    this.options = options;
  }

  apply(compiler) {
    const pluginName = 'WebpackCustomPlugin';

    // ç¼–è¯‘å¼€å§‹æ—¶
    compiler.hooks.compile.tap(pluginName, (compilationParams) => {
      console.log('ç¼–è¯‘å¼€å§‹...');
    });

    // ç¼–è¯‘å®Œæˆæ—¶
    compiler.hooks.compilation.tap(pluginName, (compilation) => {
      // èµ„æºå¤„ç†é’©å­
      compilation.hooks.processAssets.tap(
        {
          name: pluginName,
          stage: compilation.PROCESS_ASSETS_STAGE_OPTIMIZE
        },
        (assets) => {
          // å¤„ç†èµ„æº
          Object.keys(assets).forEach(filename => {
            if (filename.endsWith('.js')) {
              const asset = assets[filename];
              const source = asset.source();
              
              // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
              const processedSource = this.processJavaScript(source);
              
              // æ›´æ–°èµ„æº
              assets[filename] = {
                source: () => processedSource,
                size: () => processedSource.length
              };
            }
          });
        }
      );
    });

    // æ„å»ºå®Œæˆæ—¶
    compiler.hooks.done.tap(pluginName, (stats) => {
      console.log('æ„å»ºå®Œæˆ!');
      
      // ç”Ÿæˆæ„å»ºæŠ¥å‘Š
      if (this.options.generateReport) {
        this.generateBuildReport(stats);
      }
    });
  }

  processJavaScript(source) {
    // ç¤ºä¾‹ï¼šæ·»åŠ ç‰ˆæœ¬ä¿¡æ¯
    const version = this.options.version || '1.0.0';
    return `/* Version: ${version} */\n${source}`;
  }

  generateBuildReport(stats) {
    const report = {
      buildTime: stats.endTime - stats.startTime,
      assets: stats.compilation.assets,
      errors: stats.compilation.errors,
      warnings: stats.compilation.warnings
    };
    
    require('fs').writeFileSync(
      'build-report.json',
      JSON.stringify(report, null, 2)
    );
  }
}

// 2. Viteæ’ä»¶å¼€å‘
function viteCustomPlugin(options = {}) {
  return {
    name: 'vite-custom-plugin',
    
    // é…ç½®è§£æé’©å­
    config(config, { command }) {
      if (command === 'serve') {
        // å¼€å‘ç¯å¢ƒé…ç½®
        config.define = config.define || {};
        config.define.__DEV__ = true;
      }
    },

    // æ„å»ºå¼€å§‹é’©å­
    buildStart(opts) {
      console.log('Viteæ„å»ºå¼€å§‹...');
    },

    // æ¨¡å—è§£æé’©å­
    resolveId(id, importer) {
      if (id === 'virtual:my-module') {
        return id;
      }
    },

    // æ¨¡å—åŠ è½½é’©å­
    load(id) {
      if (id === 'virtual:my-module') {
        return `export const msg = "Hello from virtual module!";`;
      }
    },

    // æ¨¡å—è½¬æ¢é’©å­
    transform(code, id) {
      if (id.endsWith('.vue')) {
        // å¤„ç†Vueæ–‡ä»¶
        return {
          code: this.processVueFile(code),
          map: null
        };
      }
    },

    // ç”Ÿæˆbundleé’©å­
    generateBundle(options, bundle) {
      // ç”Ÿæˆé¢å¤–æ–‡ä»¶
      this.emitFile({
        type: 'asset',
        fileName: 'manifest.json',
        source: JSON.stringify({
          version: options.version,
          buildTime: new Date().toISOString()
        })
      });
    },

    // å¼€å‘æœåŠ¡å™¨é’©å­
    configureServer(server) {
      server.middlewares.use('/api/custom', (req, res, next) => {
        res.setHeader('Content-Type', 'application/json');
        res.end(JSON.stringify({ message: 'Custom API endpoint' }));
      });
    },

    processVueFile(code) {
      // è‡ªå®šä¹‰Vueæ–‡ä»¶å¤„ç†é€»è¾‘
      return code.replace(
        /<template>/g,
        '<template>\n  <!-- Processed by custom plugin -->'
      );
    }
  };
}

// 3. Rollupæ’ä»¶å¼€å‘
function rollupCustomPlugin(options = {}) {
  return {
    name: 'rollup-custom-plugin',

    // æ„å»ºå¼€å§‹
    buildStart(opts) {
      console.log('Rollupæ„å»ºå¼€å§‹...');
    },

    // æ¨¡å—è§£æ
    resolveId(id, importer) {
      if (id.startsWith('custom:')) {
        return id;
      }
      return null;
    },

    // æ¨¡å—åŠ è½½
    load(id) {
      if (id.startsWith('custom:')) {
        const moduleName = id.replace('custom:', '');
        return `export default "${moduleName} module content";`;
      }
      return null;
    },

    // ä»£ç è½¬æ¢
    transform(code, id) {
      if (options.transformJS && id.endsWith('.js')) {
        return {
          code: this.transformJavaScript(code),
          map: null
        };
      }
    },

    // ç”Ÿæˆè¾“å‡º
    generateBundle(opts, bundle) {
      // æ·»åŠ è‡ªå®šä¹‰æ–‡ä»¶åˆ°è¾“å‡º
      this.emitFile({
        type: 'asset',
        fileName: 'custom-info.txt',
        source: `Build completed at: ${new Date().toISOString()}`
      });
    },

    // å†™å…¥æ–‡ä»¶å‰
    writeBundle(opts, bundle) {
      console.log(`è¾“å‡ºåˆ°: ${opts.dir || opts.file}`);
    },

    transformJavaScript(code) {
      // ç¤ºä¾‹è½¬æ¢ï¼šæ·»åŠ ä¸¥æ ¼æ¨¡å¼
      if (!code.includes('use strict')) {
        return `'use strict';\n${code}`;
      }
      return code;
    }
  };
}

// 4. é€šç”¨æ’ä»¶å·¥å…·ç±»
class PluginUtils {
  // æ–‡ä»¶å¤„ç†å·¥å…·
  static processFile(content, transforms = []) {
    return transforms.reduce((result, transform) => {
      return transform(result);
    }, content);
  }

  // èµ„æºä¼˜åŒ–å·¥å…·
  static optimizeAsset(content, type) {
    switch (type) {
      case 'js':
        return this.minifyJS(content);
      case 'css':
        return this.minifyCSS(content);
      default:
        return content;
    }
  }

  static minifyJS(content) {
    // ç®€å•çš„JSå‹ç¼©ç¤ºä¾‹
    return content
      .replace(/\s+/g, ' ')
      .replace(/;\s*}/g, '}')
      .trim();
  }

  static minifyCSS(content) {
    // ç®€å•çš„CSSå‹ç¼©ç¤ºä¾‹
    return content
      .replace(/\s+/g, ' ')
      .replace(/;\s*}/g, '}')
      .replace(/,\s+/g, ',')
      .trim();
  }

  // ç”Ÿæˆå“ˆå¸Œ
  static generateHash(content, length = 8) {
    const crypto = require('crypto');
    return crypto
      .createHash('md5')
      .update(content)
      .digest('hex')
      .slice(0, length);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
module.exports = {
  // Webpacké…ç½®
  plugins: [
    new WebpackCustomPlugin({
      version: '1.0.0',
      generateReport: true
    })
  ],

  // Viteé…ç½®ä¸­ä½¿ç”¨
  // plugins: [viteCustomPlugin({ transformVue: true })],

  // Rollupé…ç½®ä¸­ä½¿ç”¨
  // plugins: [rollupCustomPlugin({ transformJS: true })]
};
```

## ğŸ¯ é¢è¯•æŠ€å·§æ€»ç»“

### å›ç­”ç­–ç•¥

**1. æŠ€æœ¯å¯¹æ¯”**
- æ¸…æ¥šè¯´æ˜å„æ„å»ºå·¥å…·çš„æ ¸å¿ƒå·®å¼‚
- ç»“åˆå…·ä½“åœºæ™¯åˆ†æä¼˜åŠ£

**2. å®è·µç»éªŒ**
- å±•ç¤ºå®é™…çš„é…ç½®å’Œä¼˜åŒ–ç»éªŒ
- åˆ†äº«æ€§èƒ½ä¼˜åŒ–çš„å…·ä½“æªæ–½

**3. æ·±åº¦ç†è§£**
- ç†è§£æ„å»ºå·¥å…·çš„å·¥ä½œåŸç†
- æŒæ¡æ’ä»¶å¼€å‘å’Œè‡ªå®šä¹‰é…ç½®

### åŠ åˆ†ç‚¹

1. **å…¨é¢å¯¹æ¯”**ï¼šèƒ½å¤Ÿå®¢è§‚åˆ†æå„å·¥å…·çš„ä¼˜åŠ£
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒæ¡å…·ä½“çš„ä¼˜åŒ–ç­–ç•¥å’Œé…ç½®
3. **æ’ä»¶å¼€å‘**ï¼šæœ‰è‡ªå®šä¹‰æ’ä»¶å¼€å‘ç»éªŒ
4. **è¿ç§»ç»éªŒ**ï¼šæœ‰æ„å»ºå·¥å…·è¿ç§»çš„å®è·µç»éªŒ

### å¸¸è§è¯¯åŒº

1. **ç›²ç›®è¿½æ–°**ï¼šä¸ç»“åˆé¡¹ç›®å®é™…é€‰æ‹©å·¥å…·
2. **é…ç½®è¿‡åº¦**ï¼šè¿‡åº¦ä¼˜åŒ–å¯¼è‡´é…ç½®å¤æ‚
3. **å¿½è§†ç»´æŠ¤**ï¼šä¸è€ƒè™‘é•¿æœŸç»´æŠ¤æˆæœ¬
4. **ç¼ºä¹å®è·µ**ï¼šåªäº†è§£ç†è®ºä¸äº†è§£å®é™…åº”ç”¨

### é¢è¯•å‡†å¤‡æ¸…å•

- [ ] ç†è§£å„æ„å»ºå·¥å…·çš„æ ¸å¿ƒåŸç†å’Œå·®å¼‚
- [ ] æŒæ¡Webpackå’ŒViteçš„é…ç½®å’Œä¼˜åŒ–
- [ ] äº†è§£æ’ä»¶å¼€å‘æœºåˆ¶å’ŒAPI
- [ ] å‡†å¤‡æ€§èƒ½ä¼˜åŒ–çš„å®é™…æ¡ˆä¾‹
- [ ] äº†è§£æ„å»ºå·¥å…·çš„é€‰æ‹©æ ‡å‡†
- [ ] å‡†å¤‡è¿ç§»å’Œå‡çº§çš„ç»éªŒåˆ†äº«

## ğŸ’¡ æ€»ç»“

ç°ä»£æ„å»ºå·¥å…·çš„æ ¸å¿ƒè¦ç‚¹ï¼š
1. **å·¥å…·é€‰æ‹©**ï¼šæ ¹æ®é¡¹ç›®ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ„å»ºå·¥å…·
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒæ¡æ„å»ºé€Ÿåº¦å’ŒåŒ…ä½“ç§¯ä¼˜åŒ–æŠ€å·§
3. **é…ç½®ç®¡ç†**ï¼šç†è§£é…ç½®åŸç†ï¼Œé¿å…è¿‡åº¦é…ç½®
4. **æ’ä»¶ç”Ÿæ€**ï¼šäº†è§£æ’ä»¶æœºåˆ¶ï¼Œå¿…è¦æ—¶å¼€å‘è‡ªå®šä¹‰æ’ä»¶
5. **æŒç»­ä¼˜åŒ–**ï¼šå…³æ³¨æ„å»ºå·¥å…·çš„å‘å±•ï¼Œé€‚æ—¶å‡çº§

é¢è¯•æ—¶è¦é‡ç‚¹å±•ç¤ºï¼š
- å¯¹æ„å»ºå·¥å…·åŸç†çš„æ·±å…¥ç†è§£
- å®é™…çš„æ€§èƒ½ä¼˜åŒ–ç»éªŒ
- å·¥å…·é€‰æ‹©å’Œè¿ç§»çš„åˆ¤æ–­èƒ½åŠ›
- è§£å†³å¤æ‚æ„å»ºé—®é¢˜çš„èƒ½åŠ› 