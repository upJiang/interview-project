# Git 合并与变基

## 合并概念

Git合并是将两个或多个分支的历史合并在一起的过程，合并后的代码包含所有分支的更改。

```javascript
function gitMergeConcept() {
  // Git合并的基本概念:
  // - 将一个分支的修改整合到另一个分支
  // - 默认使用"三方合并"策略，基于共同祖先
  // - 合并成功后会创建一个新的合并提交(merge commit)
  
  // 合并的类型:
  // 1. 快进合并(Fast-forward)
  // - 当目标分支是源分支的直接后代时
  // - 不会创建新的合并提交，只是移动指针
  
  // 2. 三方合并(Three-way merge)
  // - 当两个分支各自有独立的提交历史时
  // - 基于共同祖先创建新的合并提交
  // - 保留完整的历史记录
  
  // 合并冲突(Merge Conflict):
  // - 当两个分支修改了同一文件的同一部分时
  // - Git无法自动解决，需要手动解决冲突
}
```

## 合并操作

Git提供了多种合并命令和选项，用于不同的合并需求。

```javascript
function gitMergeOperations() {
  // 基本合并
  // git merge <branch>         // 将指定分支合并到当前分支
  
  // 快进合并
  // git merge --ff <branch>    // 默认行为，如果可能进行快进合并
  
  // 禁止快进合并
  // git merge --no-ff <branch> // 总是创建合并提交，即使可以快进
  
  // 压缩合并
  // git merge --squash <branch> // 将目标分支所有更改压缩为一个提交
  
  // 合并但不自动提交
  // git merge --no-commit <branch> // 合并后不自动提交，便于检查
  
  // 合并指定提交
  // git cherry-pick <commit>   // 将指定提交应用到当前分支
  
  // 中止合并
  // git merge --abort          // 发生冲突时中止合并进程
  
  // 解决冲突后继续合并
  // git merge --continue       // Git 2.12+新命令
}
```

## 变基概念

Git变基是另一种整合分支更改的方式，它通过重写提交历史来创建更线性的历史记录。

```javascript
function gitRebaseConcept() {
  // 变基(Rebase)的基本概念:
  // - 将一个分支的提交"重新应用"到另一个分支的顶部
  // - 可以创建更线性、干净的提交历史
  // - 本质上改变了提交历史，生成新的提交对象
  
  // 变基的优点:
  // - 创建更线性的历史记录
  // - 避免不必要的合并提交
  // - 使提交历史更清晰易读
  
  // 变基的缺点:
  // - 改变了提交历史，对已推送的分支变基很危险
  // - 如果处理不当，可能导致同一改动出现多次
  // - 冲突解决可能更复杂
  
  // 黄金法则:
  // 不要对已推送到公共仓库的分支执行变基操作
}
```

## 变基操作

Git变基提供了多种复杂的操作，可以精细控制提交历史。

```javascript
function gitRebaseOperations() {
  // 基本变基
  // git rebase <base>          // 将当前分支变基到指定分支
  
  // 交互式变基
  // git rebase -i <base>       // 交互式界面，可选择、修改、合并提交
  
  // 继续变基
  // git rebase --continue      // 解决冲突后继续变基过程
  
  // 跳过当前补丁
  // git rebase --skip          // 跳过当前补丁继续变基
  
  // 中止变基
  // git rebase --abort         // 中止整个变基过程，恢复原状态
  
  // 变基到远程分支
  // git rebase <remote>/<branch>
  
  // 保留合并提交的变基
  // git rebase -p <base>       // 保留合并提交的历史信息
  
  // 交互式变基的常用操作:
  // - pick: 使用该提交
  // - reword: 使用提交，但修改提交信息
  // - edit: 使用提交，但停下来修改提交内容
  // - squash: 使用提交，但与前一提交合并
  // - fixup: 类似squash，但丢弃提交信息
  // - drop: 删除提交
  // - exec: 执行shell命令
}
```

## 合并与变基的对比

合并与变基是两种不同的分支整合策略，各有优缺点。

```javascript
function mergeVsRebase() {
  // 合并(Merge)
  // 优点:
  // - 保留完整的历史记录和分支结构
  // - 不会改变现有的提交历史
  // - 对于共享分支更安全
  // 缺点:
  // - 会产生额外的合并提交
  // - 历史记录可能显得混乱，不够线性
  
  // 变基(Rebase)
  // 优点:
  // - 创建更干净、线性的历史记录
  // - 避免不必要的合并提交
  // - 便于跟踪项目历史
  // 缺点:
  // - 重写提交历史，改变提交的hash值
  // - 对已推送的分支变基可能导致问题
  // - 冲突解决过程可能更复杂
  
  // 选择策略:
  // - 个人特性分支：考虑使用变基，保持干净历史
  // - 共享的公共分支：使用合并，保留历史完整性
  // - 大型团队协作：制定清晰的分支策略和规范
}
```

## 常见面试题

1. Git合并和变基的主要区别是什么？
2. 什么情况下应该选择变基而不是合并？
3. 为什么说"不要对已推送的分支执行变基"？
4. 如何解决Git合并冲突？
5. 交互式变基的主要用途是什么？ 